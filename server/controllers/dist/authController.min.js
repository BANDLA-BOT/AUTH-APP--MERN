"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.login=exports.signup=void 0;var _userModel=_interopRequireDefault(require("../models/user.model.js")),_bcryptjs=_interopRequireDefault(require("bcryptjs")),_jsonwebtoken=_interopRequireDefault(require("jsonwebtoken"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _objectWithoutProperties(e,r){if(null==e)return{};var t,s,n=_objectWithoutPropertiesLoose(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)t=a[s],0<=r.indexOf(t)||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}function _objectWithoutPropertiesLoose(e,r){if(null==e)return{};var t,s,n={},a=Object.keys(e);for(s=0;s<a.length;s++)t=a[s],0<=r.indexOf(t)||(n[t]=e[t]);return n}var signup=function(r,t){var s,n,a,o,u,i,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.body,n=s.username,a=s.email,o=s.password,r.body){e.next=3;break}return e.abrupt("return",t.status(300).json({message:"Fields have no Data init"}));case 3:if(void 0===o)return e.abrupt("return",t.status(300).json({message:"Fields have no Data init"}));e.next=5;break;case 5:return e.next=7,regeneratorRuntime.awrap(_bcryptjs.default.genSalt(10));case 7:return u=e.sent,i=_bcryptjs.default.hashSync(o,u),c=new _userModel.default({username:n,email:a,password:i}),e.prev=10,e.next=13,regeneratorRuntime.awrap(c.save());case 13:t.status(201).json({message:"registered successfully"}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(10),t.status(500).json({message:"Internal server error",error:e.t0.message});case 19:case"end":return e.stop()}},null,null,[[10,16]])};exports.signup=signup;var login=function(r,t){var s,n,a,o,u,i,c,l;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.body,n=s.email,a=s.password,r.body){e.next=3;break}return e.abrupt("return",t.status(400).json({message:"Fields are required"}));case 3:return e.prev=3,e.next=6,regeneratorRuntime.awrap(_userModel.default.findOne({email:n}));case 6:if(o=e.sent){e.next=9;break}return e.abrupt("return",t.status(404).json({message:"User not found"}));case 9:if(_bcryptjs.default.compareSync(a,o.password)){e.next=12;break}return e.abrupt("return",t.status(404).json({message:"Incorrect Password"}));case 12:u=_jsonwebtoken.default.sign({id:o._id},process.env.JWT_ACCESS_KEY_LOGIN,{expiresIn:"15m"}),i=o._doc,i.password,c=_objectWithoutProperties(i,["password"]),l=new Date(Date.now()+36e5),t.cookie("access_token",u,{httpOnly:!0,expires:l}).status(200).json({user:c,message:"Logged in",login:!0}),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(3),t.status(500).json({message:"Internal server error",error:e.t0.message});case 21:case"end":return e.stop()}},null,null,[[3,18]])};exports.login=login;
//# sourceMappingURL=authController.min.js.map
