"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.login=exports.signup=void 0;var _userModel=_interopRequireDefault(require("../models/user.model.js")),_errorHandler=require("../utils/errorHandler.js"),_bcryptjs=_interopRequireDefault(require("bcryptjs")),_jsonwebtoken=_interopRequireDefault(require("jsonwebtoken"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _objectWithoutProperties(e,r){if(null==e)return{};var t,n,s=_objectWithoutPropertiesLoose(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],0<=r.indexOf(t)||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}function _objectWithoutPropertiesLoose(e,r){if(null==e)return{};var t,n,s={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],0<=r.indexOf(t)||(s[t]=e[t]);return s}var signup=function(r,t,n){var s,o,a,u,i,l,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.body,o=s.username,a=s.email,u=s.password,r.body){e.next=3;break}return e.abrupt("return",t.status(300).json({message:"Fields have no Data init"}));case 3:if(void 0===u)return e.abrupt("return",t.status(300).json({message:"Fields have no Data init"}));e.next=5;break;case 5:return e.next=7,regeneratorRuntime.awrap(_bcryptjs.default.genSalt(10));case 7:return i=e.sent,l=_bcryptjs.default.hashSync(u,i),c=new _userModel.default({username:o,email:a,password:l}),e.prev=10,e.next=13,regeneratorRuntime.awrap(c.save());case 13:t.status(201).json({message:"registered successfully"}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(10),n((0,_errorHandler.errorHandler)(500,"Something went wrong"));case 19:case"end":return e.stop()}},null,null,[[10,16]])};exports.signup=signup;var login=function(r,t,n){var s,o,a,u,i,l,c,p;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.body,o=s.email,a=s.password,e.prev=1,e.next=4,regeneratorRuntime.awrap(_userModel.default.findOne({email:o}));case 4:if(u=e.sent){e.next=7;break}return e.abrupt("return",n((0,_errorHandler.errorHandler)(404,"User not found on this email")));case 7:if(_bcryptjs.default.compareSync(a,u.password)){e.next=10;break}return e.abrupt("return",n((0,_errorHandler.errorHandler)(401,"Wrong credentials")));case 10:i=_jsonwebtoken.default.sign({id:u._id},process.env.JWT_ACCESS_KEY_LOGIN,{expiresIn:"15m"}),l=u._doc,l.password,c=_objectWithoutProperties(l,["password"]),p=new Date(Date.now()+36e5),t.cookie("access_token",i,{httpOnly:!0,expires:p}).status(200).json({user:c,message:"Logged in"}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),n(e.t0);case 19:case"end":return e.stop()}},null,null,[[1,16]])};exports.login=login;
//# sourceMappingURL=authController.min.js.map
